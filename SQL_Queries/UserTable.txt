CREATE TABLE IF NOT EXISTS "Users" (
    UserID SERIAL PRIMARY KEY,
    Name VARCHAR(100) NOT NULL,
    UserName VARCHAR(50) UNIQUE NOT NULL,
    Password VARCHAR(255) NOT NULL,
    Email VARCHAR(255) NOT NULL,
    Batch VARCHAR(20),
    Role VARCHAR(25) NOT NULL DEFAULT 'student'
);

CREATE OR REPLACE FUNCTION insert_user(
    user_name TEXT,
    user_role TEXT,
    user_username TEXT,
    user_password TEXT,
    user_email TEXT,
    student_batch VARCHAR(20)
)
RETURNS TABLE(
    userid INT,
    name VARCHAR(100),
    role VARCHAR(25),
    username VARCHAR(50),
    password VARCHAR(255),
    email VARCHAR(255),
    batch VARCHAR(20)
) 
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    INSERT INTO "Users" (Name, Role, UserName, Password, Email, Batch)
    VALUES (
        user_name, 
        COALESCE(user_role, 'student'), 
        user_username, 
        user_password, 
        user_email, 
        student_batch
    )
    RETURNING UserID, Name, Role, UserName, Password, Email, Batch;
END;
$$;
